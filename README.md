# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

Интерфейсы, которые используются в приложении.

IProduct — описание товара. Используется для передачи данных о товаре между слоями (получение с сервера, отображение в списках, добавление в корзину, и т.д.)
interface IProduct {
id: string; - id товара
image: string; - изображение товара
title: string; - заголовок товара
category: string; - категория товара
price: number | null; - цена товара
description: string; - краткое описание товара
}

IBuyer — описание данных покупателя. Используется при заполнении формы оформления заказа и отправке данных на сервер.

interface IBuyer {
payment: TPayment;
email: string; - эл.почта
phone: string; - номер телефона
address: string; - адрес
}

TPayment — тип для способа оплаты

type TPayment = 'card' | 'cash' | '';

Пустая строка ('') обозначает, что способ оплаты не выбран.

### Модели данных

#### Класс ProductsModel

Назначение и зона ответственности:
Хранение полного массива товаров.
Хранение товара, выбранного для отображения в модальном окне (selectedProduct).
Поиск товара по id.
Эмит событий при изменениях.

Конструктор:
constructor(initialProducts: IProduct[] = [])
initialProducts: IProduct[] — начальный массив.

Поля:
products: IProduct[] — массив всех товаров.
Описание: содержит текущий каталог; используется для рендера списка.
selectedProduct: IProduct | null — выбранный для показа товар или null — если ничего не выбрано.

Методы:
setProducts(products: IProduct[]): void
Сохраняет массив товаров в поле products и эмитит 'products:updated' с payload { products }.
getProducts(): IProduct[]
Возвращает текущий массив products.
getProductById(id: string): IProduct | undefined
Ищет и возвращает товар по id или undefined, если не найден.
setSelectedProduct(productId: string | null): void
Устанавливает selectedProduct по id (или null), эмитит 'product:selected' c payload { product: IProduct | null }.
getSelectedProduct(): IProduct | null
Возвращает selectedProduct.

#### Класс CartModel

Назначение и зона ответственности:
Хранение товаров, которые пользователь добавил в корзину.
Операции: добавление, удаление, очистка, получение суммы и количества.
Эмит событий при изменениях ('cart:updated').

Конструктор:
constructor(initialItems: IProduct[] = [])
initialItems: IProduct[] — начальный набор товаров в корзине.

Поля:
items: IProduct[] — массив товаров в корзине.
Описание: каждый элемент массива — одна единица товара.

Методы:
getItems(): IProduct[]
Возвращает массив items.
addItem(product: IProduct): void
Добавляет product в items; эмитит 'cart:updated'.
removeItem(productId: string): void
Удаляет одну единицу товара с переданным id. После удаления эмитит 'cart:updated'.
clear(): void
Очищает корзину (items = []); эмитит 'cart:updated'.
getTotalPrice(): number
Возвращает суммарную стоимость товаров: суммирует поле price каждого товара, считая price === null как 0 .
getCount(): number
Возвращает количество элементов в корзине (items.length).
hasItem(productId: string): boolean
Возвращает true, если товар с таким id присутствует в items.

#### Класс BuyerModel

Назначение и зона ответственности:
Хранение данных покупателя (payment, email, phone, address).
Очистка данных покупателя.
Валидация полей (с выдачей сообщений об ошибках для каждого поля).
Эмит событий при изменениях ('buyer:updated').

Конструктор:
constructor(initialData?: Partial<IBuyer>)
initialData: Partial<IBuyer> — объект с начальными значениями.

Поля:
payment: TPayment — 'card' | 'cash' | ''.
email: string
phone: string
address: string

Методы:
setBuyerData(data: Partial<IBuyer>): void
Обновляет только те поля, которые присутствуют в объекте data, не затирая остальные; после обновления эмитит 'buyer:updated'.
setPayment(payment: TPayment): void
Устанавливает payment и эмитит 'buyer: updated'.
setEmail(email: string): void
Устанавливает email и эмитит 'buyer: updated'.
setPhone(phone: string): void
Устанавливает phone и эмитит 'buyer: updated'.
setAddress(address: string): void
Устанавливает address и эмитит 'buyer: updated'.
getBuyer(): IBuyer
Возвращает объект со всеми полями, согласованными по дефолтам (например, пустые строки вместо undefined).
clear(): void
Очищает все поля (payment = '', email = '', phone = '', address = ''); эмитит 'buyer:updated'.
validate(): Partial<Record<keyof IBuyer, string>>
Возвращает объект ошибок валидации: ключи — поля с ошибками, значения — текст ошибки. Если ошибок нет — возвращается пустой объект {}.

### Слой коммуникаций

Назначение:

Слой коммуникации отвечает за взаимодействие с внешним сервером (API): получение каталога товаров и отправку заказов.
Он инкапсулирует HTTP-логику (вызовы fetch, обработку ошибок, нормализацию данных) и предоставляет остальному приложению удобные типизированные методы.
Реализован как класс, использующий композицию: получает в конструктор экземпляр Api и вызывает его методы get/post.

### Класс communication

Назначение:
Инкапсулировать всю сетевую логику приложения: получение каталога товаров и отправку заказов.
Предоставлять простой типизированный интерфейс для выполнения запросов (fetchProducts, sendOrder), не раскрывая деталей URL, заголовков и сериализации остальным частям приложения.

Конструктор:
constructor(api: IApi) — принимает объект, реализующий IApi.

Методы:
fetchProducts(): Promise<IProduct[]>
делает GET на /product/
возвращает массив IProduct
учитывает вариант, когда сервер может вернуть либо объекты товаров, либо только массив id (вариант B) — в таком случае класс должен либо сопоставить id с локальным кэшем, либо инициировать дополнительные запросы.
sendOrder(order: IOrderRequest): Promise<Record<string, unknown>>
делает POST на /order/ и передаёт тело заказа (buyer + items: string[]).
возвращает ответ сервера (тип можно заменить на конкретный интерфейс ответа).

#### Слой представления (View)

Слой View отвечает исключительно за отображение данных и генерацию пользовательских событий.
Компоненты представления:

не хранят состояние данных;

не содержат бизнес-логики и валидации;

получают данные через метод render;

уведомляют Презентер о действиях пользователя через EventEmitter.

Все изменения данных выполняются только через Модели, а решения о том, как реагировать на события, принимаются в Презентере (main.ts).

Общие принципы реализации View

каждый View-класс отвечает за один логический блок интерфейса;

DOM-элементы ищутся и сохраняются в конструкторе;

все обработчики событий навешиваются один раз;

метод render():

принимает данные;

записывает их в DOM;

возвращает корневой HTMLElement;

View не создают другие View внутри себя — экземпляры создаются в Презентере;

View не валидируют данные, а только отображают ошибки, полученные от Модели.

Список компонентов представления
#### GalleryView

Назначение:
Отображает каталог товаров.

Особенности реализации:

принимает массив готовых HTMLElement, подготовленных в Презентере;

не создает карточки самостоятельно.

Методы:

render(items: HTMLElement[]): HTMLElement

#### CardCatalogView

Назначение:
Отображает карточку товара в каталоге.

Шаблон: #card-catalog

Ответственность:

отображение изображения, названия, категории и цены;

генерация событий при клике по карточке и кнопке покупки.

Методы:

render(product: IProduct): HTMLElement


События:

product:select — открытие превью товара

cart:add — добавление товара в корзину

#### CardPreviewView

Назначение:
Отображает подробную информацию о товаре в модальном окне.

Шаблон: #card-preview

Ответственность:

полное описание товара;

кнопка «Купить / Удалить из корзины»;

дизейбл кнопки при отсутствии цены.

Методы:

render(data: { product: IProduct; inCart: boolean }): HTMLElement


События:

cart:add

cart:remove

modal:close

#### BasketView

Назначение:
Отображение содержимого корзины в модальном окне.

Шаблон: #basket

Особенности реализации:

получает массив HTMLElement карточек корзины;

управляет только отображением списка, суммы и кнопки оформления.

Методы:

render(items: HTMLElement[], total: number): HTMLElement


События:

order:open — переход к оформлению заказа

#### CardBasketView

Назначение:
Компактное отображение товара в корзине.

Шаблон: #card-basket

Ответственность:

отображение индекса, названия и цены товара;

кнопка удаления товара из корзины.

Методы:

render(product: IProduct, index?: number): HTMLElement


События:

cart:remove

#### ModalView

Назначение:
Универсальный компонент модального окна.

Особенности:

не наследуется;

отображает любой компонент представления;

управляет фокусом и закрытием.

Методы:

open(options?: { content?: HTMLElement }): void
close(): void


Закрытие модального окна:

клик по фону;

клик по кнопке закрытия;

клавиша Escape.

#### OrderFormView

Назначение:
Первая форма оформления заказа (способ оплаты + адрес).

Шаблон: #order

Особенности реализации:

не валидирует данные;

только эмитит события;

визуально подсвечивает выбранный способ оплаты.

Методы:

render(data?: Partial<IBuyer>): HTMLElement
setErrors(errors?: Partial<Record<keyof IBuyer, string>>): void


События:

form:payment:changed

form:field:changed

order:send

#### ContactsFormView

Назначение:
Вторая форма оформления заказа (email и телефон).

Шаблон: #contacts

Особенности реализации:

не хранит данные покупателя;

не валидирует данные;

отображает ошибки, полученные от Модели;

использует маску телефона.

Методы:

setErrors(errors?: Partial<Record<keyof IBuyer, string>>): void


События:

contacts:change

contacts:submit

#### SuccessView

Назначение:
Отображение успешного оформления заказа.

Шаблон: #success

Ответственность:

отображение итоговой суммы заказа;

кнопка возврата к покупкам.

##### Ссылка на макет:
https://www.figma.com/design/92C0vV1ZCsVpgN9cH2DZ2d/Yandex--%D0%92%D0%B5%D0%B1-%D0%BB%D0%B0%D1%80%D1%91%D0%BA-?node-id=201-9445&p=f&t=rIpwKgU1xJf6sAmx-0

##### Ссылка на репозиторий:
https://github.com/Movses23/weblarek/tree/master